name: C/C++ CI

on:
  push:
    branches: [separation_of_concerns]
  pull_request:
    branches: [separation_of_concerns]

jobs:
  # Linux

  job_linux_20_04_64_gcc:
    name: ubuntu-20.04 gcc
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: sudo apt update && sudo apt-get install gcc-10 libusb-1.0.0-dev libgtk-3-dev rpm

      - name: Build and install project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: gcc
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target install

      - name: Uninstall project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target uninstall

  job_linux_20_04_32_gcc:
    name: ubuntu-20.04 gcc 32-bit
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: sudo apt update && sudo apt-get install gcc-10 libusb-1.0.0-dev libgtk-3-dev rpm

      - name: Set compiler flags
        run: |
          CFLAGS="$CFLAGS -m32"
          CXXFLAGS="$CXXFLAGS -m32"
          LDFLAGS="$LDFLAGS -m32"

      - name: Build and install project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: gcc
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target install

      - name: Uninstall project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target uninstall

  job_linux_20_04_64_clang:
    name: ubuntu-20.04 clang
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: sudo apt update && sudo apt-get install clang-12 libusb-1.0.0-dev libgtk-3-dev rpm

      - name: Build and install project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target install

      - name: Uninstall project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target uninstall

  job_linux_20_04_32_clang:
    name: ubuntu-20.04 clang 32-bit
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: sudo apt update && sudo apt-get install clang-12 libusb-1.0.0-dev libgtk-3-dev rpm

      - name: Set compiler flags
        run: |
          CFLAGS="$CFLAGS -m32"
          CXXFLAGS="$CXXFLAGS -m32"
          LDFLAGS="$LDFLAGS -m32"

      - name: Build and install project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target install

      - name: Uninstall project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target uninstall

  job_linux_22_04_64_gcc:
    name: ubuntu-22.04 gcc
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: sudo apt update && sudo apt-get install gcc-10 libusb-1.0.0-dev libgtk-3-dev rpm

      - name: Build and install project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: gcc
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target install

      - name: Uninstall project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target uninstall

  job_linux_22_04_32_gcc:
    name: ubuntu-22.04 gcc 32-bit
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: sudo apt update && sudo apt-get install gcc-10 libusb-1.0.0-dev libgtk-3-dev rpm

      - name: Set compiler flags
        run: |
          CFLAGS="$CFLAGS -m32"
          CXXFLAGS="$CXXFLAGS -m32"
          LDFLAGS="$LDFLAGS -m32"

      - name: Build and install project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: gcc
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target install

      - name: Uninstall project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target uninstall

  job_linux_22_04_64_clang:
    name: ubuntu-22.04 clang
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: sudo apt update && sudo apt-get install clang-12 libusb-1.0.0-dev libgtk-3-dev rpm

      - name: Build and install project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target install

      - name: Uninstall project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target uninstall

  job_linux_22_04_32_clang:
    name: ubuntu-22.04 clang 32-bit
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: sudo apt update && sudo apt-get install clang-12 libusb-1.0.0-dev libgtk-3-dev rpm

      - name: Set compiler flags
        run: |
          CFLAGS="$CFLAGS -m32"
          CXXFLAGS="$CXXFLAGS -m32"
          LDFLAGS="$LDFLAGS -m32"

      - name: Build and install project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target install

      - name: Uninstall project using CMake
        uses: threeal/cmake-action@v2.0.0
        with:
          c-compiler: clang
          generator: Unix Makefiles
          options: CMAKE_BUILD_TYPE=Release
          build-args: --target uninstall